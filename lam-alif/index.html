<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="favicon.png" />
<title>Arabic Lam Alif problem on Linux | Avid Seeker</title>
<meta name="title" content="Arabic Lam Alif problem on Linux" />
<meta name="description" content="Video of the problem in Gedit
Problem: letter La (لا) keypress results in a single Unicode character (U&#43;FEFB), instead of Lam (ل) and Alif (ا) (U&#43;0644, U&#43;0627) combined in one ligature. The same problem for La variants: ﻷ، ﻵ، ﻹ.
For non-Arabic speakers, this is like having a key that is supposed to send two characters: fi (U&#43;0046 U&#43;0049), but it sends instead one ligature: ﬁ (U&#43;FB01).
This problem has been fixed in ibus." />
<meta name="keywords" content="arabic," />






  

















<meta property="og:title" content="Arabic Lam Alif problem on Linux" />
<meta property="og:description" content="Video of the problem in Gedit
Problem: letter La (لا) keypress results in a single Unicode character (U&#43;FEFB), instead of Lam (ل) and Alif (ا) (U&#43;0644, U&#43;0627) combined in one ligature. The same problem for La variants: ﻷ، ﻵ، ﻹ.
For non-Arabic speakers, this is like having a key that is supposed to send two characters: fi (U&#43;0046 U&#43;0049), but it sends instead one ligature: ﬁ (U&#43;FB01).
This problem has been fixed in ibus." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://avidseeker.github.io/lam-alif/" />

<meta property="og:image" content="http://avidseeker.github.io/images/social_card_bg_hu6706075795267934022.webp"/><meta property="article:section" content="" />
<meta property="article:published_time" content="2022-08-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-08-29T00:00:00+00:00" /><meta property="og:site_name" content="Avid Seeker" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://avidseeker.github.io/images/social_card_bg_hu6706075795267934022.webp"/>

<meta name="twitter:title" content="Arabic Lam Alif problem on Linux"/>
<meta name="twitter:description" content="Video of the problem in Gedit
Problem: letter La (لا) keypress results in a single Unicode character (U&#43;FEFB), instead of Lam (ل) and Alif (ا) (U&#43;0644, U&#43;0627) combined in one ligature. The same problem for La variants: ﻷ، ﻵ، ﻹ.
For non-Arabic speakers, this is like having a key that is supposed to send two characters: fi (U&#43;0046 U&#43;0049), but it sends instead one ligature: ﬁ (U&#43;FB01).
This problem has been fixed in ibus."/>


<meta itemprop="name" content="Arabic Lam Alif problem on Linux">
<meta itemprop="description" content="Video of the problem in Gedit
Problem: letter La (لا) keypress results in a single Unicode character (U&#43;FEFB), instead of Lam (ل) and Alif (ا) (U&#43;0644, U&#43;0627) combined in one ligature. The same problem for La variants: ﻷ، ﻵ، ﻹ.
For non-Arabic speakers, this is like having a key that is supposed to send two characters: fi (U&#43;0046 U&#43;0049), but it sends instead one ligature: ﬁ (U&#43;FB01).
This problem has been fixed in ibus."><meta itemprop="datePublished" content="2022-08-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-08-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="474">

<meta itemprop="image" content="http://avidseeker.github.io/images/social_card_bg_hu6706075795267934022.webp"/>


<meta itemprop="keywords" content="arabic," />

<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="/style.min.css" rel="stylesheet">

  
  <link href="/syntax.min.css" rel="stylesheet">

  

  
</head>

<body>
  <header><a href="/" class="title"><h1>Avid Seeker</h1></a>
<nav>
  <a href="/">Home</a>

  <a href="/issues/">Issue tracker</a>


<a href='mailto:avidseeker7@protonmail.com?subject=Reply%20to%20"Arabic%20Lam%20Alif%20problem%20on%20Linux"'>Email</a>

<a href="/index.xml">RSS</a>







</nav>
</header>
  <main>

<h1>Arabic Lam Alif problem on Linux</h1>
<p>
  <i>
    <time datetime='2022-08-29' pubdate>
      2022-08-29
    </time>
  </i>
</p>

<content>
  <p><img alt="Screenshot of the problem in Gedit" src="https://i.imgur.com/SrUKXuc.jpeg"></p>
<p><a href="https://i.imgur.com/T1DYO3b.mp4">Video of the problem in Gedit</a></p>
<p>Problem: letter La (لا) keypress results in a single Unicode character (U+FEFB),
instead of Lam (ل) and Alif (ا) (U+0644, U+0627) combined in one ligature. The
same problem for La variants: ﻷ، ﻵ، ﻹ.</p>
<p>For non-Arabic speakers, this is like having a key that is supposed to send two
characters: <code>fi</code> (U+0046 U+0049), but it sends instead one ligature: <code>ﬁ</code> (U+FB01).</p>
<p>This problem has been fixed in ibus. Since Gnome uses ibus by default, Gnome
desktops should have this problem resolved. If you&rsquo;re using KDE or other desktop
environment, this problem may still persist.</p>
<h2 id="solution-using-ibus">Solution using ibus</h2>
<ol>
<li>Install ibus v1.5.28 or later:</li>
</ol>
<p>For Arch Linux</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># pacman -S ibus</span>
</span></span></code></pre></div><p>For Ubuntu/Debian-based:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># apt install ibus</span>
</span></span></code></pre></div><p>For Fedora:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># dnf install ibus</span>
</span></span></code></pre></div><ol start="2">
<li>Run <code>ibus-setup</code></li>
<li>Run <code>ibus-daemon</code>.</li>
<li>Run <code>im-chooser</code> and choose <code>ibus</code>.</li>
<li>Restart Xorg session</li>
</ol>
<p>Some distributions like <a href="https://bbs.archlinux.org/viewtopic.php?id=287812">Arch</a> may not have
<code>im-chooser</code>. In that case make sure the following <a href="https://wiki.archlinux.org/title/Environment_variables">environment variables</a> are
set</p>
<pre tabindex="0"><code>GTK_IM_MODULE=ibus
QT_IM_MODULE=ibus
XMODIFIERS=@im=ibus
</code></pre><h2 id="applications-affected">Applications affected</h2>
<p>Qt mysteriously handles this issue, so Qt-based apps like Kate are not affected
by this. On the other hand, GTK-based apps, like Firefox and Chromium, do have
this problem.</p>
<p>Setting the environment variable <code>QT_IM_MODULE=ibus</code> doesn&rsquo;t have a clear effect
yet. Qt is suspected to solve this issue by implementing XKB original compose
mode.</p>
<p>Readings while figuring out how Qt handles this issue:</p>
<ol>
<li><a href="https://doc.qt.io/qt-6/internationalization.html">Qt official i18n docs</a></li>
<li><a href="https://web.mit.edu/~firebird/arch/sun4x_59/doc/html/scripts.html">Qt3 brief ligature docs</a></li>
</ol>
<h2 id="technical-details">Technical details</h2>
<p>The problem originates from <a href="https://www.freedesktop.org/wiki/Software/XKeyboardConfig/XKB2Dreams/">XKB limitation</a>
that prevents it from mapping a single keypress to multiple keysyms. The
current solution works by utilizing <a href="https://en.wikipedia.org/wiki/Compose_key">compose tables</a> support of input methods.
The idea is to map a key sequence of length 1 consisting of the ligature
(U+FEFB) into the 2 characters: (U+0644, U+0627). This is why it is considered
&ldquo;hacky&rdquo;: compose function was never designed to be used that way. This can
actually be seen from where XCompose reads from:</p>
<pre tabindex="0"><code>cat /usr/share/X11/locale/en_US.UTF-8/Compose | grep LAM
---
&lt;UFEFB&gt;	: &#34;لا&#34; # ARABIC LIGATURE LAM WITH ALEF
</code></pre><p>So virtually any input method having this hack of &ldquo;single-letter compose
sequence&rdquo; can actually solve this problem. Despite <a href="https://en.wikipedia.org/wiki/Xim">XIM</a>
being an old and unrecommended input method, it still solves this problem since
it supports the &ldquo;hack&rdquo;. Try setting this as an environment variable:</p>
<pre tabindex="0"><code>GTK_IM_MODULE=xim
</code></pre><h2 id="single-key-compose-sequence-support">Single-key compose sequence support</h2>
<p>Single-key Compose sequences to make single key presses generate multi-character
sequences.</p>
<ul>
<li><a href="https://gitlab.freedesktop.org/xorg/lib/libx11/-/commit/21e464ec682ab23ba20ddf6bd72c6db214cfbe01">Xorg</a>: supported since 2008-06-20.</li>
<li><a href="https://github.com/mike-fabian/ibus-typing-booster/issues/379">ibus-typing-booster</a> supported since v2.19.0.</li>
<li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=2125153">ibus</a>: supported since ibus-1.5.27-9.fc38.</li>
</ul>
<p>GTK changelog:</p>
<ul>
<li>2022-09-08: <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2125163">bugzilla</a></li>
<li>2022-09-12: <a href="https://gitlab.gnome.org/GNOME/gtk/-/issues/5172">Gitlab</a></li>
<li>2022-09-13: <a href="https://gitlab.gnome.org/GNOME/gtk/-/commit/952f85c12de13e978294af58f26694eddb3a1ee0">Proposed fix for GTK4</a></li>
<li>2022-08-08: <a href="https://gitlab.gnome.org/GNOME/gtk/-/merge_requests/6358">Fix regressed</a></li>
</ul>
<p>On-screen keyboard support:</p>
<ul>
<li>2023-11-14: <a href="https://gitlab.gnome.org/GNOME/gnome-shell/-/issues/7190">GNOME OSK</a></li>
</ul>
<h2 id="issue-tracker">Issue tracker</h2>
<p>Archived discussions:</p>
<ul>
<li><a href="https://bugzilla.gnome.org/show_bug.cgi?id=537457">Gnome</a></li>
<li><a href="https://bugs.kde.org/show_bug.cgi?id=458442">KDE</a></li>
<li><a href="https://bugs.launchpad.net/ubuntu/+bug/1988133">Ubuntu</a></li>
<li><a href="https://askubuntu.com/questions/1426252/arabic-keyboard-layout-sends-ligatures-as-one-character-laa-problem">askubuntu</a></li>
<li><a href="https://code.google.com/archive/p/ibus/issues/1630">Google</a></li>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=277850">arch forums</a></li>
<li><a href="https://bugs.freedesktop.org/show_bug.cgi?id=8195">XDG bugzilla issue</a></li>
<li><a href="https://gitlab.freedesktop.org/xorg/xserver/-/issues/346">XDG Gitlab issue</a></li>
<li><a href="https://khaledhosny.github.io/2009/05/01/%D8%AD%D9%84-%D9%85%D8%B4%D9%83%D9%84%D8%A9-%D8%A7%D9%84%D9%84%D8%A7%D9%85-%D8%A3%D9%84%D9%81-%D9%81%D9%8A-%D8%A7%D9%84%D8%AA%D9%88%D8%B2%D9%8A%D8%B9%D8%A7%D8%AA-%D8%A7%D9%84%D8%AD%D8%AF%D9%8A%D8%AB%D8%A9.html">Khaled Hosny blog post</a></li>
</ul>
<h2 id="credits">Credits</h2>
<p>Thanks for your contributions and responsiveness to closing these issues.</p>
<ul>
<li>Fujiwara San</li>
<li>Matthias Clasen</li>
<li>Mike Fabian</li>
</ul>
<p>On an unrelated note, single-key compose sequence might be an easy
implementation for <a href="https://youtu.be/lIFE7h3m40U">Tom Scott&rsquo;s</a> emoji keyboard.</p>

</content>
<p>
  
    <a class="blog-tags" href="http://avidseeker.github.io/tags/arabic/">#Arabic</a>&nbsp;&nbsp;
  
</p>

  </main>
  <footer><small>
  AvidSeeker (CC-BY-SA 4 or GFDL) | 
</small></footer>

    
</body>

</html>
